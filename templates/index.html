<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G-Tracker | Form Response Analyzer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Export Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</head>

<body>
    <div class="background-globes">
        <div class="globe globe-1"></div>
        <div class="globe globe-2"></div>
        <div class="globe globe-3"></div>
    </div>

    <div class="container">
        <header class="hero">
            <h1 class="logo">G-Tracker <span class="dot">.</span></h1>
            <p class="subtitle">Separate the active from the inactive. Instantly.</p>
        </header>

        <!-- View 1: Login / Sign Up -->
        <section id="view-login" class="view active">
            <div class="glass-panel" style="width: 100%; max-width: 450px;">
                <div class="auth-tabs">
                    <button class="auth-tab active" id="tabLogin">Login</button>
                    <button class="auth-tab" id="tabSignup">Sign Up</button>
                </div>

                <div id="loginForm">
                    <h1 class="auth-title">Welcome Back</h1>
                    <p class="auth-subtitle">Access your response tracker</p>

                    <div class="input-group">
                        <i class="fa-solid fa-user"></i>
                        <input type="text" id="usernameInput" placeholder="Username">
                    </div>
                    <div class="input-group">
                        <i class="fa-solid fa-lock"></i>
                        <input type="password" id="passwordInput" placeholder="Password">
                    </div>

                    <button class="auth-btn" id="btnLogin">
                        Sign In <i class="fa-solid fa-arrow-right-to-bracket"></i>
                    </button>
                </div>

                <div id="signupForm" class="hidden">
                    <h1 class="auth-title">Join G-Tracker</h1>
                    <p class="auth-subtitle">Create a new account</p>

                    <div class="input-group">
                        <i class="fa-solid fa-circle-user"></i>
                        <input type="text" id="newUsername" placeholder="Full Name">
                    </div>
                    <div class="input-group">
                        <i class="fa-solid fa-envelope"></i>
                        <input type="email" id="newEmail" placeholder="Email Address">
                    </div>
                    <div class="input-group">
                        <i class="fa-solid fa-lock"></i>
                        <input type="password" id="newPassword" placeholder="Create Password">
                    </div>

                    <button class="auth-btn" id="btnSignup">
                        Create Account <i class="fa-solid fa-user-plus"></i>
                    </button>
                </div>
            </div>
        </section>

        <!-- View 2: About & How it Works -->
        <section id="view-about" class="view-section hidden">
            <div class="glass-panel about-panel">
                <h2>About G-Tracker <i class="fa-solid fa-wand-magic-sparkles"></i></h2>
                <div class="about-content">
                    <p>G-Tracker is your intelligent companion for managing Google Form submissions. We help you bridge
                        the gap between "sent" and "received" with ultra-fast analysis.</p>

                    <h3 style="margin-top: 2rem; color: var(--accent-cyan);">How it Works</h3>
                    <div class="about-grid">
                        <div class="process-step">
                            <i class="fa-brands fa-google-drive"></i>
                            <h4>Step 1: Link</h4>
                            <p>Paste the Google Sheets URL where responses are stored.</p>
                        </div>
                        <div class="process-step">
                            <i class="fa-solid fa-file-csv"></i>
                            <h4>Step 2: Upload</h4>
                            <p>Or simply drag and drop your Excel/CSV export directly.</p>
                        </div>
                        <div class="process-step">
                            <i class="fa-solid fa-magnifying-glass-chart"></i>
                            <h4>Step 3: Analyze</h4>
                            <p>We'll detect missing names and incomplete submissions instantly.</p>
                        </div>
                    </div>
                </div>
                <button id="btnFromAbout" class="primary-btn" style="margin-top: 2rem;">
                    <span>Go to Dashboard</span>
                    <i class="fa-solid fa-rocket"></i>
                </button>
            </div>
        </section>

        <!-- View 3: Dashboard (The App) -->
        <section id="view-app" class="view-section hidden">
            <div class="welcome-banner">
                <h3>System Ready, <span id="displayUsername">User</span> <i class="fa-solid fa-bolt"></i></h3>
                <button id="btnLogout" class="logout-btn" title="Logout">
                    <i class="fa-solid fa-right-from-bracket"></i>
                    <span>Logout</span>
                </button>
            </div>

            <main class="glass-panel main-input">
                <div class="mode-toggle">
                    <button class="toggle-btn active" id="btnLinkMode">
                        <i class="fa-brands fa-google-drive"></i>
                        <span>Cloud Link</span>
                    </button>
                    <button class="toggle-btn" id="btnFileMode">
                        <i class="fa-solid fa-cloud-arrow-up"></i>
                        <span>Local File</span>
                    </button>
                </div>

                <div id="modeLink" class="input-mode">
                    <div class="input-group">
                        <i class="fa-solid fa-link input-icon"></i>
                        <input type="text" id="sheetUrl" placeholder="Enter Google Sheet URL..." autocomplete="off">
                    </div>
                </div>

                <div id="modeFile" class="input-mode hidden">
                    <div class="file-drop-area" id="dropArea">
                        <i class="fa-solid fa-file-arrow-up file-icon"
                            style="font-size: 2.5rem; color: var(--accent-cyan);"></i>
                        <p>Drop Excel/CSV here or <span>Browse</span></p>
                        <input type="file" id="fileInput" accept=".csv, .xlsx, .xls" hidden>
                    </div>
                    <div id="filePreview" class="file-preview hidden">
                        <i class="fa-solid fa-file-circle-check"></i>
                        <span id="fileName">data.xlsx</span>
                        <i class="fa-solid fa-trash remove-file" id="removeFile"
                            style="cursor:pointer; margin-left: auto;"></i>
                    </div>
                </div>

                <!-- Master List Section -->
                <div class="master-list-section" style="margin-top: 1.5rem; text-align: left;">
                    <label class="section-label"
                        style="display: block; margin-bottom: 0.5rem; font-size: 0.9rem; color: rgba(255,255,255,0.7);">
                        <i class="fa-solid fa-clipboard-list"></i> Master Student List (Optional)
                    </label>
                    <textarea id="masterListInput"
                        placeholder="Paste list of all student names here (one per line) to detect who is completely missing..."
                        style="width: 100%; height: 100px; background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); border-radius: 12px; color: white; padding: 1rem; resize: vertical; font-family: 'Outfit', sans-serif;"></textarea>
                </div>

                <div class="action-buttons" style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                    <button id="checkBtn" class="primary-btn" style="flex: 2;">
                        <span>Analyze Responses</span>
                        <i class="fa-solid fa-bolt-lightning"></i>
                    </button>
                </div>
            </main>

            <div id="loading" class="hidden">
                <div class="spinner"></div>
                <p>Analyzing spreadsheet data...</p>
            </div>

            <section id="results" class="results-section hidden">
                <div class="results-actions" style="display: flex; justify-content: flex-end; margin-bottom: 1rem;">
                    <button id="btnExport" class="secondary-btn"
                        style="background: rgba(16, 185, 129, 0.2); border: 1px solid rgba(16, 185, 129, 0.4); color: #6ee7b7; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer; transition: all 0.3s ease;">
                        <i class="fa-solid fa-file-excel"></i> Export to Excel
                    </button>
                </div>

                <div class="stats-container">
                    <div class="stat-card">
                        <h3>Total Students</h3>
                        <p id="totalCount">0</p>
                    </div>
                    <div class="stat-card responded">
                        <h3>Responded</h3>
                        <p id="respondedCount">0</p>
                    </div>
                    <div class="stat-card not-responded">
                        <h3>Incomplete</h3>
                        <p id="notRespondedCount">0</p>
                    </div>
                    <div class="stat-card missing"
                        style="border-top: 3px solid #ef4444; background: rgba(239, 68, 68, 0.1);">
                        <h3>Missing</h3>
                        <p id="missingCount">0</p>
                    </div>
                </div>

<<<<<<< HEAD
                <div class="export-controls">
                    <button id="downloadExcel" class="export-btn excel">
                        <i class="fa-solid fa-file-excel"></i>
                        <span>Download Excel</span>
                    </button>
                    <button id="downloadPDF" class="export-btn pdf">
                        <i class="fa-solid fa-file-pdf"></i>
                        <span>Download PDF</span>
                    </button>
                </div>

                <div class="results-tabs">
                    <button class="res-tab active" id="tabResponded">
                        <i class="fa-solid fa-check-double"></i>
                        <span>Responded</span>
                    </button>
                    <button class="res-tab not-filled" id="tabNotResponded">
                        <i class="fa-solid fa-circle-exclamation"></i>
                        <span>Not Responded</span>
                    </button>
                </div>

                <div class="results-slider-container">
                    <div class="results-slider" id="resultsSlider">
                        <!-- Slide 1: Responded -->
                        <div class="results-slide">
                            <div class="list-card responded-card">
                                <div class="list-header responded-header">
                                    <div>
                                        <h3>Responded <span class="badge" id="respondedBadge">0</span></h3>
                                        <small>All fields filled</small>
                                    </div>
                                    <button class="copy-btn" id="copyResponded" title="Copy List"><i
                                            class="fa-regular fa-copy"></i></button>
                                </div>
                                <div class="table-wrapper">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Student Name</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="respondedTableBody">
                                            <!-- Rows -->
                                        </tbody>
                                    </table>
                                    <div class="table-footer">
                                        <span class="total-label">Total Responded:</span>
                                        <span class="total-value" id="respondedTableTotal">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Slide 2: Not Responded -->
                        <div class="results-slide">
                            <div class="list-card not-responded-card">
                                <div class="list-header not-responded-header">
                                    <div>
                                        <h3>Not Responded <span class="badge" id="notRespondedBadge">0</span></h3>
                                        <small>Incomplete / Missing</small>
                                    </div>
                                    <button class="copy-btn" id="copyNotResponded" title="Copy List"><i
                                            class="fa-regular fa-copy"></i></button>
                                </div>
                                <div class="table-wrapper">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>Student Name</th>
                                                <th>Missing Info</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody id="notRespondedTableBody">
                                            <!-- Rows -->
                                        </tbody>
                                    </table>
                                    <div class="table-footer">
                                        <span class="total-label">Total Pending:</span>
                                        <span class="total-value" id="notRespondedTableTotal">0</span>
                                    </div>
                                </div>
=======
                <div class="results-grid" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));">
                    <!-- Responded List -->
                    <div class="list-card responded-card">
                        <div class="list-header responded-header">
                            <div>
                                <h3>Responded <span class="badge" id="respondedBadge">0</span></h3>
                                <small>All fields filled</small>
                            </div>
                            <button class="copy-btn" id="copyResponded" title="Copy List"><i
                                    class="fa-regular fa-copy"></i></button>
                        </div>
                        <ul id="respondedUl" class="student-list">
                            <!-- Items -->
                        </ul>
                    </div>

                    <!-- Incomplete List (Filled but missing fields) -->
                    <div class="list-card not-responded-card">
                        <div class="list-header not-responded-header">
                            <div>
                                <h3>Incomplete <span class="badge" id="notRespondedBadge">0</span></h3>
                                <small>Missing specific answers</small>
>>>>>>> ea01a9c (feat: implement strict backend auth and refined signup flow)
                            </div>
                        </div>
                    </div>

                    <!-- Missing List (Not in sheet at all) -->
                    <div class="list-card missing-card"
                        style="border: 1px solid rgba(239, 68, 68, 0.3); background: rgba(20, 20, 30, 0.6);">
                        <div class="list-header missing-header"
                            style="border-bottom: 1px solid rgba(239, 68, 68, 0.3);">
                            <div>
                                <h3 style="color: #fca5a5;">Missing <span class="badge" id="missingBadge"
                                        style="background: rgba(239, 68, 68, 0.2); color: #fca5a5;">0</span></h3>
                                <small>Not found in submissions</small>
                            </div>
                            <button class="copy-btn" id="copyMissing" title="Copy List" style="color: #fca5a5;"><i
                                    class="fa-regular fa-copy"></i></button>
                        </div>
                        <ul id="missingUl" class="student-list">
                            <!-- Items -->
                        </ul>
                    </div>
                </div>
            </section>
        </section>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>

</html>